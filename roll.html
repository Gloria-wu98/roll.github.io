<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯é€±å‡ºç¼ºå‹¤é»åè¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªè¨‚ TailwindCSS */
        body {
            font-family: 'Inter', sans-serif; /* ä½¿ç”¨ Inter å­—é«” */
        }
        .teacher-input {
            min-width: 100px; /* æ•™å¸«è¼¸å…¥æ¡†æœ€å°å¯¬åº¦ */
        }
        /* è‡ªè¨‚çš„ "X" æ¨™è¨˜æ¨£å¼ */
        .custom-checkbox-container {
            width: 2em; /* èª¿æ•´å®¹å™¨å¤§å°ä»¥é©æ‡‰ "X" */
            height: 2em; /* èª¿æ•´å®¹å™¨å¤§å°ä»¥é©æ‡‰ "X" */
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d1d5db; /* ç°è‰²é‚Šæ¡† */
            border-radius: 0.25rem; /* åœ“è§’ */
            cursor: pointer;
            margin: auto; /* ä½¿å…¶åœ¨å„²å­˜æ ¼ä¸­ç½®ä¸­ */
        }
        .custom-checkbox-container.checked .x-mark {
            display: inline; /* è¢«é¸ä¸­æ™‚é¡¯ç¤º "X" */
            color: #ef4444; /* ç´…è‰² */
            font-weight: bold;
            font-size: 1.25em; /* èª¿æ•´ "X" çš„å¤§å° */
        }
        .x-mark {
            display: none; /* é è¨­éš±è— "X" */
        }

        th, td {
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            text-align: center;
            white-space: nowrap;
        }
        th {
            background-color: #f3f4f6; /* è¡¨é ­èƒŒæ™¯è‰² */
            font-weight: 600;
        }
        tfoot td {
            font-weight: 600;
            background-color: #f3f4f6; /* è¡¨å°¾èƒŒæ™¯è‰² (é è¨­) */
        }
        .sticky-col {
            position: -webkit-sticky;
            position: sticky;
            /* background-color: white;  å°‡ç”±æ›´å…·é«”çš„æ¯æ—¥èƒŒæ™¯è‰²é¡åˆ¥è¦†è“‹ */
        }
        .sticky-col-date { left: 0; z-index: 10;}
        .sticky-col-period { left: 80px; z-index: 10;} /* æ ¹æ“šå¯¦éš›æ—¥æœŸæ¬„ä½å¯¬åº¦èª¿æ•´ */
        .sticky-col-teacher { left: 160px; z-index: 10;} /* æ ¹æ“šå¯¦éš›æ—¥æœŸ+ç¯€æ¬¡æ¬„ä½å¯¬åº¦èª¿æ•´ */

        thead th {
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 20; /* é«˜æ–¼æ»¾å‹•å…§å®¹ */
        }
        /* å›ºå®šæ¬„ä½çš„è¡¨é ­éœ€è¦æ›´é«˜çš„ z-index */
        thead .sticky-col-date { z-index: 30; background-color: #f3f4f6 !important; } /* ç¢ºä¿è¡¨é ­å›ºå®šæ¬„èƒŒæ™¯èˆ‡è¡¨é ­ä¸€è‡´ */
        thead .sticky-col-period { z-index: 30; background-color: #f3f4f6 !important; }
        thead .sticky-col-teacher { z-index: 30; background-color: #f3f4f6 !important; }


        .text-red-500 {
            color: #ef4444;
        }
        .bg-sky-200 { /* å‰¯æ¨™é¡Œæ·ºè—è‰²èƒŒæ™¯ */
            background-color: #bae6fd;
        }
        /* ä»¥ä¸‹ç‚ºæ¯æ—¥èƒŒæ™¯è‰²ï¼ŒTailwind æ¨™æº–é¡åˆ¥ï¼Œç„¡éœ€åœ¨æ­¤å®šç¾© */
        /* .bg-yellow-100 (Mon, Wed, Fri) */
        /* .bg-sky-100 (Tue) */
        /* .bg-green-100 (Thu) */
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-gray-700">æ¯é€±å‡ºç¼ºå‹¤é»åè¡¨</h1>
            <p class="text-sm text-gray-600 mt-2 p-2 rounded bg-sky-200 inline-block">è¡¨æ ¼å‰µå»ºäººï¼šGloriaå³ç§€è˜­è€å¸«ï¼ŒGoogleèªè­‰è¬›å¸«ï¼Œè‹±æ–‡å…¼å°èªæ•™å¸«</p>
            <p class="text-sm text-gray-500 mt-3 font-bold">ğŸ™Œè«‹åœ¨ä¸‹æ–¹è¡¨æ ¼æ¨™æ³¨è©²ä½åŒå­¸è©²ç¯€èª²æ› èª²ç‹€æ³ã€‚</p>
        </header>

        <div class="mb-6 flex flex-col sm:flex-row items-center sm:space-x-3 bg-white p-4 rounded-lg shadow">
            <label for="weekStart" class="text-sm font-medium text-gray-700 mb-2 sm:mb-0 font-bold">é¸æ“‡é€±ä¸€æ—¥æœŸï¼š</label>
            <input type="date" id="weekStart" class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
        </div>

        <div id="tableContainer" class="overflow-x-auto bg-white rounded-lg shadow">
            <table id="attendanceTable" class="min-w-full border-collapse border border-gray-300">
                <thead id="tableHeader" class="bg-gray-100">
                    </thead>
                <tbody id="tableBody">
                    </tbody>
                <tfoot id="tableFooter" class="bg-gray-100 font-semibold">
                    </tfoot>
            </table>
        </div>
         <div id="noDataMessage" class="hidden mt-4 text-center text-gray-500">
            è«‹é¸æ“‡æ—¥æœŸä»¥è¼‰å…¥é»åè¡¨ã€‚
        </div>
    </div>

    <script>
        // å­¸ç”Ÿåå–®
        const students = [
            { seat: "1", id: "219001", name: "æœç­±æ¸" }, { seat: "2", id: "219002", name: "ç‹å®¥é§" },
            { seat: "3", id: "219003", name: "ç‹éŸ‹éˆ" }, { seat: "4", id: "219004", name: "ç‹å°‰ä¸" },
            { seat: "5", id: "219005", name: "ç‹ç¨Ÿç¨‹" }, { seat: "6", id: "219006", name: "æœ±å½¥éœ–" },
            { seat: "7", id: "219007", name: "å³æŸèª¼" }, { seat: "8", id: "219008", name: "æå°šéŒ¤" },
            { seat: "9", id: "219009", name: "æå½¥å»·" }, { seat: "10", id: "219010", name: "æ—æ­£å‹›" },
            { seat: "11", id: "219011", name: "æ—æ¾ä¾‘" }, { seat: "12", id: "219012", name: "æ—å† å»·" },
            { seat: "13", id: "219013", name: "æ—å† ç©" }, { seat: "14", id: "219014", name: "æ—åšå®£" },
            { seat: "15", id: "219015", name: "æ—æ¯…é‘«" }, { seat: "16", id: "219016", name: "é™³ç¿Šå‡±" },
            { seat: "17", id: "219017", name: "èŠæ–‡ç¦¾" }, { seat: "18", id: "219018", name: "éƒ­å®¥è¾°" },
            { seat: "19", id: "219019", name: "éƒ­æŸå²‘" }, { seat: "20", id: "219020", name: "é™³å‹æ–‡" },
            { seat: "21", id: "219021", name: "é™³æ†ç¿Š" }, { seat: "22", id: "219022", name: "é™³æŸå®‡" },
            { seat: "23", id: "219023", name: "é»ƒå† æ¾¤" }, { seat: "24", id: "219024", name: "é»ƒå®¥å˜‰" },
            { seat: "25", id: "219025", name: "å»–æ™‰ä½‘" }, { seat: "26", id: "219026", name: "è¬å°šè«­" },
            { seat: "27", id: "219027", name: "è¬åšå®‰" }, { seat: "29", id: "219029", name: "è˜‡å¥•é½Š" }
        ];

        const NUM_PERIODS = 7; // æ¯æ—¥ç¯€æ¬¡æ•¸
        const NUM_DAYS = 5;    // æ¯é€±å¤©æ•¸ (é€±ä¸€è‡³é€±äº”)

        const weekStartInput = document.getElementById('weekStart');
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        const tableFooter = document.getElementById('tableFooter');
        const noDataMessage = document.getElementById('noDataMessage');
        const tableContainer = document.getElementById('tableContainer');

        function initializeDate() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diffToMonday = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            const monday = new Date(today.setDate(diffToMonday));
            weekStartInput.valueAsDate = monday;
            renderTable(monday);
        }

        function renderTable(startDate) {
            if (!startDate || isNaN(startDate.getTime())) {
                 tableContainer.classList.add('hidden');
                 noDataMessage.classList.remove('hidden');
                return;
            }
            tableContainer.classList.remove('hidden');
            noDataMessage.classList.add('hidden');

            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            tableFooter.innerHTML = '';

            const headerRow = tableHeader.insertRow();
            const dateTh = headerRow.insertCell();
            dateTh.textContent = 'æ—¥æœŸ';
            dateTh.classList.add('sticky-col', 'sticky-col-date');

            const periodTh = headerRow.insertCell();
            periodTh.textContent = 'ç¯€æ¬¡';
            periodTh.classList.add('sticky-col', 'sticky-col-period');

            const teacherTh = headerRow.insertCell();
            teacherTh.textContent = 'ä»»èª²æ•™å¸«';
            teacherTh.classList.add('sticky-col', 'sticky-col-teacher');

            students.forEach(student => {
                const studentTh = headerRow.insertCell();
                studentTh.textContent = `${student.seat}. ${student.name}`;
                studentTh.classList.add('px-2', 'py-3', 'text-xs');
            });

            for (let dayIndex = 0; dayIndex < NUM_DAYS; dayIndex++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + dayIndex);
                const dateString = currentDate.toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit' });
                const dayName = currentDate.toLocaleDateString('zh-TW', { weekday: 'short' });

                let rowBgClass = '';
                // dayIndex 0: Mon, 1: Tue, 2: Wed, 3: Thu, 4: Fri
                if (dayIndex === 0 || dayIndex === 2 || dayIndex === 4) { // é€±ä¸€, é€±ä¸‰, é€±äº”
                    rowBgClass = 'bg-yellow-100'; // Tailwind: #fef9c3
                } else if (dayIndex === 1) { // é€±äºŒ
                    rowBgClass = 'bg-sky-100';   // Tailwind: #e0f2fe
                } else { // é€±å›› (dayIndex === 3)
                    rowBgClass = 'bg-green-100'; // Tailwind: #dcfce7
                }

                for (let periodIndex = 0; periodIndex < NUM_PERIODS; periodIndex++) {
                    const row = tableBody.insertRow();
                    // row.classList.add(rowBgClass); // èƒŒæ™¯è‰²å°‡å¥—ç”¨åˆ°æ¯å€‹å„²å­˜æ ¼

                    const dateCell = row.insertCell();
                    dateCell.classList.add(rowBgClass); // å¥—ç”¨æ¯æ—¥èƒŒæ™¯è‰²åˆ°å„²å­˜æ ¼
                    if (periodIndex === 0) {
                        dateCell.textContent = `${dateString} (${dayName})`;
                        dateCell.rowSpan = NUM_PERIODS;
                        dateCell.classList.add('sticky-col', 'sticky-col-date', 'align-middle');
                    } else {
                        dateCell.classList.add('hidden');
                    }

                    const periodCell = row.insertCell();
                    periodCell.textContent = (periodIndex + 1).toString();
                    periodCell.classList.add('sticky-col', 'sticky-col-period', 'align-middle', rowBgClass);

                    const teacherCell = row.insertCell();
                    const teacherInput = document.createElement('input');
                    teacherInput.type = 'text';
                    teacherInput.placeholder = 'æ•™å¸«å§“å';
                    teacherInput.classList.add('teacher-input', 'w-full', 'p-1', 'border', 'border-gray-300', 'rounded-md', 'text-sm', 'bg-transparent'); // è¼¸å…¥æ¡†èƒŒæ™¯é€æ˜
                    teacherCell.appendChild(teacherInput);
                    teacherCell.classList.add('sticky-col', 'sticky-col-teacher', 'align-middle', rowBgClass);

                    students.forEach(student => {
                        const attendanceCell = row.insertCell();
                        attendanceCell.classList.add(rowBgClass); // å¥—ç”¨æ¯æ—¥èƒŒæ™¯è‰²åˆ°å„²å­˜æ ¼
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.classList.add('custom-checkbox-container');
                        checkboxContainer.dataset.studentId = student.id;
                        checkboxContainer.dataset.checked = "false";

                        const xMark = document.createElement('span');
                        xMark.classList.add('x-mark');
                        xMark.textContent = 'X';
                        checkboxContainer.appendChild(xMark);

                        checkboxContainer.addEventListener('click', () => {
                            const isChecked = checkboxContainer.dataset.checked === "true";
                            checkboxContainer.dataset.checked = (!isChecked).toString();
                            checkboxContainer.classList.toggle('checked', !isChecked);
                            updateAbsenceTotals();
                        });
                        attendanceCell.appendChild(checkboxContainer);
                        attendanceCell.classList.add('align-middle');
                    });
                }
            }

            const footerRow = tableFooter.insertRow();
            const totalLabelCell = footerRow.insertCell();
            totalLabelCell.textContent = 'è©²é€±æ› èª²çµ±è¨ˆ';
            totalLabelCell.colSpan = 3;
            // ç¢ºä¿è¡¨å°¾çš„å›ºå®šå„²å­˜æ ¼èƒŒæ™¯èˆ‡è¡¨å°¾ä¸€è‡´
            totalLabelCell.classList.add('text-right', 'pr-4', 'sticky-col', 'sticky-col-date', 'bg-gray-100');


            students.forEach(student => {
                const totalCell = footerRow.insertCell();
                totalCell.id = `total-cell-${student.id}`;
                totalCell.textContent = '0';
                totalCell.classList.add('align-middle');
                // è¡¨å°¾çµ±è¨ˆæ•¸å­—çš„èƒŒæ™¯æ‡‰èˆ‡è¡¨å°¾ä¸€è‡´
                totalCell.classList.add('bg-gray-100');
            });
            updateAbsenceTotals();
        }

        function updateAbsenceTotals() {
            students.forEach(student => {
                let absenceCount = 0;
                const customCheckboxes = document.querySelectorAll(`.custom-checkbox-container[data-student-id="${student.id}"]`);
                customCheckboxes.forEach(checkbox => {
                    if (checkbox.dataset.checked === "true") {
                        absenceCount++;
                    }
                });
                const totalCell = document.getElementById(`total-cell-${student.id}`);
                if (totalCell) {
                    totalCell.textContent = absenceCount.toString();
                    if (absenceCount > 0) {
                        totalCell.classList.add('text-red-500');
                    } else {
                        totalCell.classList.remove('text-red-500');
                    }
                }
            });
        }

        weekStartInput.addEventListener('change', (event) => {
            const selectedDate = new Date(event.target.value);
            if (selectedDate.getDay() !== 1) { // å¦‚æœé¸æ“‡çš„ä¸æ˜¯é€±ä¸€
                alert('è«‹é¸æ“‡é€±ä¸€çš„æ—¥æœŸã€‚');
                const dayOfWeek = selectedDate.getDay();
                const diffToMonday = selectedDate.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                const monday = new Date(selectedDate.setDate(diffToMonday));
                weekStartInput.valueAsDate = monday;
                renderTable(monday);
            } else {
                renderTable(selectedDate);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            initializeDate();
             if (!weekStartInput.value) {
                tableContainer.classList.add('hidden');
                noDataMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
